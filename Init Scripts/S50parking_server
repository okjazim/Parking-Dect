#!/bin/sh

PY=/usr/bin/python3
APP=/park_dect/parking_server.py
LOG=/tmp/parking_server.log
PID=/tmp/parking_server.pid

start() {
  echo "Starting parking server..."
  cd /park_dect || exit 1

  # Start only if not already running
  if [ -f "$PID" ] && kill -0 "$(cat $PID)" 2>/dev/null; then
    echo "Parking server already running."
    return 0
  fi

  $PY $APP >>"$LOG" 2>&1 &
  echo $! > "$PID"
  echo "Started, pid=$(cat $PID). Log: $LOG"
}

stop() {
  echo "Stopping parking server..."
  if [ -f "$PID" ]; then
    kill "$(cat $PID)" 2>/dev/null
    rm -f "$PID"
  fi
}

case "$1" in
  start) start ;;
  stop) stop ;;
  restart) stop; sleep 1; start ;;
  *) echo "Usage: $0 {start|stop|restart}"; exit 1 ;;
esac
exit 0

